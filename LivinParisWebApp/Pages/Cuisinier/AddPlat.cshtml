@page
@model LivinParisWebApp.Pages.Cuisinier.AddPlatModel
@{
    Layout = "~/Pages/Shared/_NavBarLayout.cshtml";
    ViewData["Title"] = "Création de plat";
}

<head>
    <link rel="stylesheet" href="/css/site.css" />
</head>

<div class="top-panel-plat">
    <p class="message-top-panel">Création de plat</p>
</div>

<form method="post">
    <div class="checkbox-use-platdujour" style="display: flex; justify-content: center; margin-bottom: 1em;">
        <input type="hidden" name="UsePlatJour" value="true" />
        <button type="submit" asp-page-handler="CochePlatDuJour" class="btn-confirm">Utiliser le plat du jour</button>
    </div>
</form>

<form method="post" class="form-plat" enctype="multipart/form-data">
    <input type="hidden" asp-for="ImageUrl" />
    <div class="content-today-plat">
        <div class="left-colonne">
            <div class="ligne1">
                <div class="inputs">
                    <input asp-for="NomDuPlat" placeholder="Nom du Plat" />
                    <input asp-for="Prix" placeholder="Prix" />
                </div>
            </div>
            <div class="ligne2">
                <div class="inputs">
                    <input asp-for="NbDePersonnes" placeholder="Nb de Personnes" />
                    <input asp-for="Type" placeholder="Type" />
                </div>
            </div>
            <div class="ligne3">
                <div class="creation-container">
                    <p>Création</p>
                    <div class="input-creation">
                        <select asp-for="JourCreation">
                            <option disabled selected>Jour</option>
                            @for (int i = 1; i <= 30; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>

                        <!-- Mois dropdown -->
                        <select asp-for="MoisCreation">
                            <option disabled selected>Mois</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>

                        <!-- Année dropdown -->
                        <select asp-for="AnneeCreation">
                            <option disabled selected>Année</option>
                            @for (int i = 2022; i <= 2028; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="ligne4">
                <div class="peremption-container">
                    <p>Péremption</p>
                    <div class="input-peremption">
                        <select asp-for="JourPerem">
                            <option disabled selected>Jour</option>
                            @for (int i = 1; i <= 30; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>
                        <select asp-for="MoisPerem">
                            <option disabled selected>Mois</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>
                        <select asp-for="AnneePerem">
                            <option disabled selected>Année</option>
                            @for (int i = 2025; i <= 2028; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-colonne">
            <div class="ligne1">
                <div class="charge">
                    <p>Photo</p>
                    <!-- Input masqué -->
                    <input asp-for="ImageFile" type="file" id="fileInput" accept="image/*" style="display: none;" />

                    <!-- Label stylé pour déclencher l'ouverture du sélecteur de fichiers -->
                    <label for="fileInput" class="load-img">
                        <p>Choisir une image</p>
                    </label>
                    @* <button class="load-img" type="button"><p>Charger</p></button> *@
                </div>
                <div class="img-container">
                    <p>Aperçu</p>
                    <img id="preview" src="@(Model.ImageUrl ?? "/images/plats/default.png")" alt="Aperçu" />
                </div>
            </div>
            <div class="ligne2">
                <div class="inputs">
                    <input asp-for="Nationalite" placeholder="Nationalité" />
                    <input asp-for="Regime" placeholder="Régime" />
                </div>
            </div>
            <div class="ligne3">
                <div class="ingre-container">
                    <p>Ingrédients</p>
                    <div class="input-ingre">
                        <input asp-for="Ingredients" placeholder="Ingrédients" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-actions">
        <button class="btn-confirm" asp-page-handler="CuisinierPanelConfirm" type="submit">Confirmer</button>
    </div>
</form>

<!-- FORM SECONDAIRE POUR RETOUR -->
<form method="post" class="form-bottom-plat">
    <button class="btn-back" type="submit" asp-page-handler="CuisinierPanelRetour">Retour</button>
</form>
@section Scripts {
    <script>
        const fileInput = document.querySelector('input[type="file"]');
        const preview = document.getElementById('preview');

        // Aperçu si on choisit manuellement une image
        fileInput?.addEventListener('change', e => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => preview.src = e.target.result;
                reader.readAsDataURL(file);
            }
        });

        // Aperçu automatique si ImageUrl est déjà défini côté C#
        const imageUrl = '@Model.ImageUrl';
        if (imageUrl && imageUrl !== 'null') {
            preview.src = imageUrl;
            const hiddenInput = document.querySelector('input[name="ImageUrl"]');
            if (hiddenInput) hiddenInput.value = imageUrl;
        }

        //Met à jour le champ ImageUrl pour le POST
        const hiddenImageInput = document.querySelector('input[name="ImageUrl"]');
        if (hiddenImageInput) {
            hiddenImageInput.value = imageUrl;
        }
    </script>
}
